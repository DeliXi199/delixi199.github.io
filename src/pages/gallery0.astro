---
import fs from 'node:fs';
import path from 'node:path';
import BaseLayout from '../layouts/BaseLayout.astro';
import BaseCard from '../components/BaseCard.astro';
import GalleryClient from '../components/GalleryClient.jsx';

const imageDir = path.resolve('./public/image/Gallery');
const descriptionPath = path.resolve('./public/image/Gallery/descriptions.md');

const files = fs.readdirSync(imageDir)
  .filter(name => /\.(jpe?g|png|webp|gif)$/i.test(name))
  .sort((a, b) => a.localeCompare(b, 'zh-Hans-CN', { numeric: true }));

const captions = fs.readFileSync(descriptionPath, 'utf-8')
  .split('\n')
  .map(line => line.replace(/^\d+\.?\s*/, '').trim())
  .filter(line => line.length > 0);

const images = files.map((filename, i) => ({
  src: `/image/Gallery/${filename}`,
  caption: captions[i] || ''
}));
---

<BaseLayout title="Gallery">
  <BaseCard title="画廊展示">
    <!-- 只保留挂载点，交给 React 完全渲染 -->
    <GalleryClient client:load images={images} />
  </BaseCard>
</BaseLayout>
