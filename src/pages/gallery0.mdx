
import BaseLayout from "../layouts/BaseLayout.astro";
import BaseCard from "../components/BaseCard.astro";


<BaseLayout title="Gallery">
  <BaseCard title="画廊展示">
    <>
      <style>
        {`
        /* 基础布局与复古画钉风格 */
        .gallery-container * { box-sizing: border-box; margin: 0; padding: 0; }
        .gallery-container {
          font-family: 'Homemade Apple', cursive;
          background: url('https://images.pexels.com/photos/172277/pexels-photo-172277.jpeg') repeat;
          background-size: cover;
          padding: 1rem;
          border-radius: 10px;
        }
        .gallery-container .controls {
          text-align: center;
          padding: 20px;
        }
        .gallery-container .controls button {
          margin: 0 10px;
          padding: 10px 20px;
          font-size: 16px;
          background-color: #f5f0e1;
          color: #444;
          border: 2px solid #d2b48c;
          border-radius: 10px;
          box-shadow: 2px 2px 6px rgba(0,0,0,0.2);
          transition: all 0.3s ease;
          font-family: 'Homemade Apple', cursive;
        }
        .gallery-container .controls button:hover {
          background-color: #e6d5b8;
          box-shadow: 2px 4px 8px rgba(0,0,0,0.3);
          transform: translateY(-2px);
        }
        .gallery-container ul {
          padding: 20px;
          list-style: none;
          text-align: center;
        }
        .gallery-container li {
          display: inline-block;
          margin: 0 20px 20px 0;
          border: 12px solid #fff;
          border-radius: 4px;
          background: #fff;
          box-shadow: inset 0 2px 4px rgba(0,0,0,0.1), 0 10px 20px rgba(0,0,0,0.3);
          position: relative;
          top: 50px;
          transform-origin: center bottom;
          transition: all .6s ease;
          cursor: zoom-in;
        }
        .gallery-container li:hover {
          transform: scale(1.05);
          top: 0;
          opacity: .9;
          z-index: 1;
        }
        .gallery-container li::after {
          content: '';
          position: absolute;
          top: -10px; left: -10px;
          width: 20px; height: 20px;
          background: radial-gradient(circle at 35% 35%, #fff 20%, #ddd 45%, #aaa 75%, #888 100%);
          border: 1px solid #666;
          border-radius: 50%;
          box-shadow: inset 0 2px 3px rgba(255,255,255,0.8),
                      inset 0 -2px 3px rgba(0,0,0,0.3),
                      0 2px 4px rgba(0,0,0,0.4);
          pointer-events: none;
        }
        .gallery-container li::before {
          content: '';
          position: absolute;
          top: 8px; left: -2px;
          width: 4px; height: 18px;
          background: linear-gradient(to bottom, #ccc 0%, #999 50%, #666 100%);
          border-radius: 2px;
          box-shadow: inset 0 1px 1px rgba(255,255,255,0.6), 0 1px 2px rgba(0,0,0,0.3);
          transform: rotate(15deg);
          pointer-events: none;
        }
        .gallery-container .photo img {
          display: block;
          border-radius: 2px;
          filter: contrast(1.1) brightness(0.95) saturate(1.2);
          box-shadow: 0 4px 8px rgba(0,0,0,0.2);
          pointer-events: none;
        }
        .gallery-container .photo .caption {
          position: absolute;
          top: 0; left: 0;
          width: 100%; height: 100%;
          display: flex;
          align-items: center;
          justify-content: center;
          background: rgba(0, 0, 0, 0.6);
          color: #fff;
          font-size: 1rem;
          opacity: 0;
          transition: opacity 0.3s ease;
          pointer-events: none;
        }
        .gallery-container li:hover .caption {
          opacity: 1;
          transition-delay: 0.8s;
        }

        /* 全局 Lightbox 弹层，初始隐藏，使用 .open 展示 */
        #lightbox {
          display: none !important;
          position: fixed !important;
          inset: 0 !important;
          background: rgba(0,0,0,0.8) !important;
          justify-content: center;
          align-items: center;
          z-index: 9999 !important;
        }
        #lightbox.open {
          display: flex !important;
        }
        #lightbox img {
          max-width: 90vw !important;
          max-height: 90vh !important;
          box-shadow: 0 0 30px rgba(0,0,0,0.6) !important;
        }
        `}
      </style>

    <div class="gallery-container">
<div class="controls">
  <button id="shuffleBtn">随机排序</button>
  <button id="sortBtn">顺序排列</button>
  <button id="reverseBtn">倒序排列</button>
</div>
<ul id="gallery">
<li>
  <div class="photo">
    <img src="/image/Gallery/1.jpg"/>
    <div class="caption">人生独一份，所以我才是真的“理工”男？</div>
  </div>
</li>
<li>
  <div class="photo">
    <img src="/image/Gallery/2.jpg"/>
    <div class="caption">毕业典礼时看到雨中的行政楼，突然有了要毕业的感觉</div>
  </div>
</li>
<li>
  <div class="photo">
    <img src="/image/Gallery/3.jpg"/>
    <div class="caption">枫园3单元永远的201寝</div>
  </div>
</li>
<li>
  <div class="photo">
    <img src="/image/Gallery/4.jpg"/>
    <div class="caption">离别总是这么突然，但也要笑着再见</div>
  </div>
</li>
<li>
  <div class="photo">
    <img src="/image/Gallery/5.jpg"/>
    <div class="caption">我和我的4个傻儿子，最后的聚餐在海底捞（所以我穿的是工作服吗？</div>
  </div>
</li>

</ul>
</div>

      <div id="lightbox"><img src="" alt="放大图" /></div>

      <script is:inline>
        {`
        (function() {
          const ul = document.querySelector('#gallery');
          const originalItems = Array.from(ul.children);
          let currentItems = [...originalItems];
          const lightbox = document.querySelector('#lightbox');
          const lbImg = lightbox.querySelector('img');
          const BASE_LONG = 270, MIN_F = 0.9, MAX_F = 1.1;

          // 将 lightbox 挂载到 body
          document.body.appendChild(lightbox);

          function applyRandomSize() {
            document.querySelectorAll('.photo img').forEach(img => {
              function resize() {
                const { naturalWidth: w, naturalHeight: h } = img;
                const factor = MIN_F + Math.random() * (MAX_F - MIN_F);
                const target = BASE_LONG * factor;
                if (w >= h) img.style.width = target + 'px';
                else img.style.height = target + 'px';
              }
              img.complete ? resize() : img.onload = resize;
            });
          }

          // 同时添加随机水平位移和随机旋转
          function applyRandomRotation() {
            document.querySelectorAll('#gallery li').forEach(li => {
              const angle = (Math.random() * 20 - 10).toFixed(2);
              const offsetX = (Math.random() * 20 - 10).toFixed(2); // ±10px
              const offsetY = (Math.random() * 20 - 10).toFixed(2); // ±10px
              li.style.transform = \`translateX(\${offsetX}px) translateY(\${offsetY}px) rotate(\${angle}deg)\`;
            });
          }

          function renderItems(items) {
            ul.innerHTML = '';
            items.forEach(item => ul.appendChild(item));
            applyRandomSize();
            applyRandomRotation();
            bindClickEvents();
          }

          function bindClickEvents() {
            document.querySelectorAll('#gallery li').forEach(li => {
              li.onclick = () => {
                const imgSrc = li.querySelector('img').src;
                lbImg.src = imgSrc;
                lightbox.classList.add('open');
              };
            });
          }

          // 初始随机渲染
          currentItems = [...originalItems].sort(() => Math.random() - 0.5);
          renderItems(currentItems);

          // 控件按钮
          document.querySelector('#shuffleBtn').onclick = () => renderItems([...currentItems].sort(() => Math.random()-0.5));
          document.querySelector('#sortBtn').onclick = () => renderItems(originalItems);
          document.querySelector('#reverseBtn').onclick = () => renderItems([...originalItems].reverse());

          // 点击遮罩或 Esc 关闭弹层
          lightbox.onclick = () => lightbox.classList.remove('open');
          document.addEventListener('keydown', e => {
            if (e.key === 'Escape') lightbox.classList.remove('open');
          });
        })();
        `}
      </script>
    </>
  </BaseCard>
</BaseLayout>
